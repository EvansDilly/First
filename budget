<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Budget Planner</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* ===== General Styles ===== */
html, body {
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  font-family: Arial,sans-serif;
  background: #f4f7f9;
  color: #333;
  transition: background 0.3s, color 0.3s;
}
body.dark {background:#1f1f1f;color:#ddd;}
h1 {margin:0;font-size:1.5em;}
form, .summary {
  max-width:600px;
  margin:10px auto;
  padding:15px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
body.dark form, body.dark .summary {background:#333;color:#ddd;box-shadow:0 4px 10px rgba(0,0,0,0.5);}
input, select, textarea {
  width:100%;
  padding:8px;
  margin-top:5px;
  border-radius:6px;
  border:1px solid #ccc;
  box-sizing:border-box;
}
body.dark input, body.dark select, body.dark textarea {background:#555;color:#fff;border:1px solid #777;}
button {margin-top:10px;background:#3498db;color:#fff;border:none;border-radius:8px;font-size:16px;cursor:pointer;padding:8px 12px;transition:0.2s;}
button:hover {background:#2980b9;}
table {width:100%;border-collapse:collapse;margin-top:10px;display:block;overflow-x:auto;}
th, td {border:1px solid #ccc;padding:8px;text-align:left;white-space:nowrap;}
th {background:#3498db;color:white;}
body.dark th {background:#555;border-color:#777;color:white;}
#recentMonths {max-height:250px;overflow-y:auto;padding:10px;background:#fff;border-radius:8px;border:1px solid #ccc;}
body.dark #recentMonths {background:#333;border:1px solid #777;}
img.goalImage {max-width:100%;border-radius:8px;margin:5px 0;}
footer {text-align:center;padding:10px;background:#2c3e50;color:white;border-radius:8px;margin-top:20px;}
body.dark footer {background:#111;color:white;}

/* ===== Header + Menu ===== */
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#3498db;
  color:white;
  padding:10px 15px;
  position:sticky;
  top:0;
  z-index:1000;
}
#menuToggle {font-size:24px;background:none;border:none;color:white;cursor:pointer;}
#menuPanel {
  position:fixed;
  top:0;
  right:-260px; /* completely hidden on right */
  width:250px;
  height:100%;
  background:#fff;
  box-shadow:-2px 0 5px rgba(0,0,0,0.3);
  padding:15px;
  transition:right 0.3s;
  z-index:1001;
  overflow-y:auto;
}
body.dark #menuPanel {background:#222;color:#ddd;}
#menuPanel h3 {margin-top:0;}
#menuPanel button {width:100%;margin-top:10px;padding:12px; cursor:pointer;}
#menuOverlay {
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.4);
  z-index:1000;
}

/* ===== Responsive ===== */
@media(max-width:480px){
  h1{font-size:1.2em;}
  input,select,textarea,button{font-size:15px;padding:8px;}
  th,td{padding:6px;}
  form,.summary{padding:10px;margin:10px;}
}
.shoppingImages{display:flex;flex-wrap:wrap;gap:10px;}
.shoppingImages img{max-width:45%;border-radius:8px;}
</style>
</head>
<body>

<!-- ===== Header ===== -->
<header>
  <h1>Smart Budget Planner</h1>
  <button id="menuToggle">â˜° Menu</button>
</header>

<!-- ===== Menu Panel ===== -->
<nav id="menuPanel">
  <h3>Menu</h3>
  <button onclick="viewPreviousMonths()">Previous Months/Years</button>
  <button onclick="simulateMillion()">Simulator: First Million in 10 Years</button>
  <button onclick="searchRecords()">Search Records</button>
  <button onclick="reachUs()">Reach Us</button>
  <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
</nav>
<div id="menuOverlay"></div>

<!-- ===== Main Content ===== -->
<form id="budgetForm">
<label>Month</label>
<select id="month"><option disabled selected>Select month</option>
<option>January</option><option>February</option><option>March</option><option>April</option></select>

<label>Year</label>
<select id="year"><option disabled selected>Select year</option><option>2025</option><option>2026</option></select>

<label>Gross Salary</label>
<select id="salary"><option disabled selected>Select salary</option>
<script>for(let s=10000;s<=20000;s+=1000){document.write(`<option>${s}</option>`);}</script></select>

<h3>Deductions</h3>
<label><input type="checkbox" id="useNSSF"> NSSF</label>
<label><input type="checkbox" id="useSHA"> SHA</label>
<label><input type="checkbox" id="useHousing"> Housing Levy</label>

<label>Rent</label><input type="number" id="rent" placeholder="Rent amount">
<label>Food/Basics</label><input type="number" id="food" placeholder="Food/Basics">
<label>Transport</label><input type="number" id="transport" placeholder="Transport">
<label>Other Expenses</label><input type="number" id="other" placeholder="Other expenses">
<label>Savings/Goals</label><input type="number" id="savings" placeholder="Auto-calculated">

<h3>Shopping Goals</h3>
<input type="text" id="itemName" placeholder="Item Name">
<input type="number" id="itemPrice" placeholder="Price">
<input type="file" id="itemImage" accept="image/*">
<button type="button" onclick="addShoppingToTable()">Add to List</button>

<div style="overflow-x:auto;">
<table id="shoppingTable">
<thead><tr><th>Select</th><th>Item</th><th>Price</th><th>Image</th><th>Achieved</th></tr></thead>
<tbody></tbody>
</table>
</div>
<button type="button" onclick="deleteSelectedItems()">Delete Selected Items</button>

<h3>Notes / Emotions / Goals</h3>
<textarea id="userNotes" rows="4" placeholder="Write notes, emotions, goals..." maxlength="500"></textarea>

<button type="button" onclick="addBudget()">Add Budget</button>
<button type="button" onclick="showWealthTips()">How to Grow Your Balance ðŸ’°</button>
<div id="wealthTips" style="display:none;"></div>
</form>

<div class="summary" id="summary" style="display:none;">
<h2>Summary</h2>
<p id="netSalary"></p>
<p id="totalExpenses"></p>
<p id="balance"></p>
<h3>Shopping List</h3>
<div id="shoppingSummary"></div>
<div id="notesSummary"></div>
</div>

<h3>Recent Months</h3>
<div id="recentMonths"></div>

<canvas id="pieChart" style="max-width:100%;"></canvas>
<canvas id="barChart" style="max-width:100%;"></canvas>

<footer>Powered by Evans</footer>

<script>
// ===== Menu Toggle =====
const menuToggle = document.getElementById('menuToggle');
const menuPanel = document.getElementById('menuPanel');
const menuOverlay = document.getElementById('menuOverlay');

function toggleMenu(){
  if(menuPanel.style.right==='0px'){
    menuPanel.style.right='-260px';
    menuOverlay.style.display='none';
  } else{
    menuPanel.style.right='0px';
    menuOverlay.style.display='block';
  }
}
menuToggle.addEventListener('click', toggleMenu);
menuOverlay.addEventListener('click', toggleMenu);

// ===== Dark Mode & Reach Us =====
function toggleDarkMode(){document.body.classList.toggle('dark');toggleMenu();}
function reachUs(){
  toggleMenu();
  const choice=prompt("Type 1 for WhatsApp, 2 for Telegram:");
  if(choice==='1') window.open("https://wa.me/254116726618","_blank");
  else if(choice==='2') window.open("https://t.me/Dilly125","_blank");
}

// ===== Budget Logic =====
let records = JSON.parse(localStorage.getItem('budgetRecords')||'[]');
let shoppingList=[];
const SHA_RATE=0.0275,NSSF_RATE=0.06,NSSF_CAP=2160,HOUSING_RATE=0.015;

function addShoppingToTable(){
  const name=document.getElementById('itemName').value;
  const price=parseFloat(document.getElementById('itemPrice').value);
  const file=document.getElementById('itemImage').files[0];
  if(!name || isNaN(price)){ alert("Enter valid item and price"); return;}
  let imgData=null;
  if(file){
    if(file.size>5*1024*1024){ alert("Max image size 5MB"); return;}
    const reader=new FileReader();
    reader.onload=function(e){ imgData=e.target.result; shoppingList.push({name,price,image:imgData,achieved:false}); renderShoppingTable();};
    reader.readAsDataURL(file);
  } else shoppingList.push({name,price,image:null,achieved:false});
  renderShoppingTable();
  document.getElementById('itemName').value=''; document.getElementById('itemPrice').value=''; document.getElementById('itemImage').value='';
}

function renderShoppingTable(){
  const tbody=document.querySelector('#shoppingTable tbody'); tbody.innerHTML='';
  shoppingList.forEach((item,i)=>{
    const row=document.createElement('tr');
    row.innerHTML=`<td><input type="checkbox" data-index="${i}"></td>
    <td>${item.name}</td>
    <td>${item.price.toFixed(2)}</td>
    <td>${item.image?'<img src="'+item.image+'" class="goalImage">':''}</td>
    <td><input type="checkbox" ${item.achieved?'checked':''} onclick="toggleAchieve(${i},this.checked)"></td>`;
    tbody.appendChild(row);
  });
}
function toggleAchieve(i,val){shoppingList[i].achieved=val;}
function deleteSelectedItems(){
  const checkboxes=document.querySelectorAll('#shoppingTable tbody input[type="checkbox"][data-index]:checked');
  const indexes=Array.from(checkboxes).map(cb=>parseInt(cb.getAttribute('data-index')));
  shoppingList=shoppingList.filter((_,i)=>!indexes.includes(i));
  renderShoppingTable();
}

// ===== Add Budget with Duplicate Prevention =====
function addBudget(){
  const month=document.getElementById('month').value;
  const year=document.getElementById('year').value;
  const salary=parseFloat(document.getElementById('salary').value);
  if(!month || !year || isNaN(salary)){ alert("Select month/year/salary"); return;}
  
  const monthYearKey = month+" "+year;
  const existingIndex = records.findIndex(r=>r.monthYear===monthYearKey);
  if(existingIndex!==-1){
    if(!confirm("This month/year already exists. Click OK to replace existing record.")) return;
    records.splice(existingIndex,1); // remove old
  }

  const rent=parseFloat(document.getElementById('rent').value)||0;
  const food=parseFloat(document.getElementById('food').value)||0;
  const transport=parseFloat(document.getElementById('transport').value)||0;
  const other=parseFloat(document.getElementById('other').value)||0;
  const useNSSF=document.getElementById('useNSSF').checked;
  const useSHA=document.getElementById('useSHA').checked;
  const useHousing=document.getElementById('useHousing').checked;
  const notes=document.getElementById('userNotes').value;
  const nssf=useNSSF?Math.min(salary*NSSF_RATE,NSSF_CAP):0;
  const sha=useSHA?salary*SHA_RATE:0;
  const housing=useHousing?salary*HOUSING_RATE:0;
  const totalExp=rent+food+transport+other+nssf+sha+housing;
  const savings=salary-totalExp;
  document.getElementById('savings').value=savings.toFixed(2);
  
  const entry={monthYear:monthYearKey,grossSalary:salary,deductions:{nssf,sha,housing},expenses:{rent,food,transport,other},shopping:[...shoppingList],savings,notes};
  records.push(entry);
  localStorage.setItem('budgetRecords',JSON.stringify(records));
  shoppingList=[];
  renderShoppingTable();
  displaySummary(entry);
  alert("Budget saved!");
}

// ===== Display Summary =====
function displaySummary(entry){
  document.getElementById('summary').style.display='block';
  document.getElementById('netSalary').innerText="Gross Salary: KES "+entry.grossSalary.toFixed(2);
  const totalExp=entry.deductions.nssf+entry.deductions.sha+entry.deductions.housing+entry.expenses.rent+entry.expenses.food+entry.expenses.transport+entry.expenses.other;
  document.getElementById('totalExpenses').innerText="Total Expenses: KES "+totalExp.toFixed(2);
  document.getElementById('balance').innerText="Balance/Savings: KES "+entry.savings.toFixed(2);
  
  const shoppingDiv=document.getElementById('shoppingSummary'); shoppingDiv.innerHTML="";
  entry.shopping.forEach(item=>{
    const div=document.createElement('div');
    div.innerHTML=`<strong>${item.name}</strong> - KES ${item.price.toFixed(2)}<br>${item.image?'<img src="'+item.image+'" class="goalImage">':''}<br>Status: ${item.achieved?'Achieved':'Unachieved'}`;
    shoppingDiv.appendChild(div);
  });

  const notesDiv=document.getElementById('notesSummary'); 
  notesDiv.innerHTML=`<h4>Notes / Emotions / Goals</h4><p>${entry.notes || "No notes added."}</p>`;
}

// ===== Show Wealth Tips =====
function showWealthTips(){
  const tips=document.getElementById('wealthTips');
  tips.style.display = tips.style.display==='block'?'none':'block';
  tips.innerHTML="<h4>5 Ways to Grow Your Balance</h4><ol><li>MMF: Low-risk money market funds.</li><li>Stocks: Invest in shares for higher returns.</li><li>Savings account: High-interest savings account.</li><li>Side Hustle: Freelance or small business.</li><li>Government bonds: Secure long-term investments.</li></ol>";
}

// ===== View Previous Months =====
function viewPreviousMonths(){
  toggleMenu();
  const div=document.getElementById('recentMonths'); div.innerHTML="";
  records.forEach(entry=>{
    const d=document.createElement('div');
    d.innerHTML=`<strong>${entry.monthYear}</strong> - Balance: KES ${entry.savings.toFixed(2)} <button onclick='displaySummary(records.find(r=>r.monthYear==="${entry.monthYear}"))'>View Details</button>`;
    div.appendChild(d);
  });
}

// ===== Simulation =====
function simulateMillion(){
  toggleMenu();
  const salary=parseFloat(prompt("Enter your monthly net salary:"))||0;
  const savings=parseFloat(prompt("Enter your monthly savings:"))||0;
  const years=10;
  const months=years*12;
  const rate=0.07/12;
  let balance=0;
  for(let i=0;i<months;i++) balance=(balance+savings)*(1+rate);
  alert("If you save KES "+savings+" per month with 7% yearly interest, you will have KES "+balance.toFixed(2)+" in 10 years.");
}

// ===== Search Records by Month =====
function searchRecords(){
  toggleMenu();
  const monthSearch = prompt("Enter month/year to search (e.g., 'January 2026'):");
  if(!monthSearch) return;
  const found = records.find(r=>r.monthYear.toLowerCase()===monthSearch.toLowerCase());
  if(found) displaySummary(found);
  else alert("No record found for "+monthSearch);
}
</script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Budget Planner</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* ===== General Styles ===== */
html, body {
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  font-family: Arial,sans-serif;
  background: #f4f7f9;
  color: #333;
  transition: background 0.3s, color 0.3s;
}
body.dark {background:#1f1f1f;color:#ddd;}
h1 {margin:0;font-size:1.5em;}
form, .summary {
  max-width:600px;
  margin:10px auto;
  padding:15px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
body.dark form, body.dark .summary {background:#333;color:#ddd;box-shadow:0 4px 10px rgba(0,0,0,0.5);}
input, select, textarea {
  width:100%;
  padding:8px;
  margin-top:5px;
  border-radius:6px;
  border:1px solid #ccc;
  box-sizing:border-box;
}
body.dark input, body.dark select, body.dark textarea {background:#555;color:#fff;border:1px solid #777;}
button {margin-top:10px;background:#3498db;color:#fff;border:none;border-radius:8px;font-size:16px;cursor:pointer;padding:8px 12px;transition:0.2s;}
button:hover {background:#2980b9;}
table {width:100%;border-collapse:collapse;margin-top:10px;display:block;overflow-x:auto;}
th, td {border:1px solid #ccc;padding:8px;text-align:left;white-space:nowrap;}
th {background:#3498db;color:white;}
body.dark th {background:#555;border-color:#777;color:white;}
#recentMonths {max-height:250px;overflow-y:auto;padding:10px;background:#fff;border-radius:8px;border:1px solid #ccc;}
body.dark #recentMonths {background:#333;border:1px solid #777;}
img.goalImage {max-width:100%;border-radius:8px;margin:5px 0;}
footer {text-align:center;padding:10px;background:#2c3e50;color:white;border-radius:8px;margin-top:20px;}
body.dark footer {background:#111;color:white;}

/* ===== Header + Menu ===== */
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#3498db;
  color:white;
  padding:10px 15px;
  position:sticky;
  top:0;
  z-index:1000;
}
#menuToggle {font-size:24px;background:none;border:none;color:white;cursor:pointer;}
#menuPanel {
  position:fixed;
  top:0;
  right:-260px; /* completely hidden on right */
  width:250px;
  height:100%;
  background:#fff;
  box-shadow:-2px 0 5px rgba(0,0,0,0.3);
  padding:15px;
  transition:right 0.3s;
  z-index:1001;
  overflow-y:auto;
}
body.dark #menuPanel {background:#222;color:#ddd;}
#menuPanel h3 {margin-top:0;}
#menuPanel button {width:100%;margin-top:10px;padding:12px; cursor:pointer;}
#menuOverlay {
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.4);
  z-index:1000;
}

/* ===== Responsive ===== */
@media(max-width:480px){
  h1{font-size:1.2em;}
  input,select,textarea,button{font-size:15px;padding:8px;}
  th,td{padding:6px;}
  form,.summary{padding:10px;margin:10px;}
}
.shoppingImages{display:flex;flex-wrap:wrap;gap:10px;}
.shoppingImages img{max-width:45%;border-radius:8px;}
</style>
</head>
<body>

<!-- ===== Header ===== -->
<header>
  <h1>Smart Budget Planner</h1>
  <button id="menuToggle">â˜° Menu</button>
</header>

<!-- ===== Menu Panel ===== -->
<nav id="menuPanel">
  <h3>Menu</h3>
  <button onclick="viewPreviousMonths()">Previous Months/Years</button>
  <button onclick="simulateMillion()">Simulator: First Million in 10 Years</button>
  <button onclick="searchRecords()">Search Records</button>
  <button onclick="reachUs()">Reach Us</button>
  <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
</nav>
<div id="menuOverlay"></div>

<!-- ===== Main Content ===== -->
<form id="budgetForm">
<label>Month</label>
<select id="month"><option disabled selected>Select month</option>
<option>January</option><option>February</option><option>March</option><option>April</option></select>

<label>Year</label>
<select id="year"><option disabled selected>Select year</option><option>2025</option><option>2026</option></select>

<label>Gross Salary</label>
<select id="salary"><option disabled selected>Select salary</option>
<script>for(let s=10000;s<=20000;s+=1000){document.write(`<option>${s}</option>`);}</script></select>

<h3>Deductions</h3>
<label><input type="checkbox" id="useNSSF"> NSSF</label>
<label><input type="checkbox" id="useSHA"> SHA</label>
<label><input type="checkbox" id="useHousing"> Housing Levy</label>

<label>Rent</label><input type="number" id="rent" placeholder="Rent amount">
<label>Food/Basics</label><input type="number" id="food" placeholder="Food/Basics">
<label>Transport</label><input type="number" id="transport" placeholder="Transport">
<label>Other Expenses</label><input type="number" id="other" placeholder="Other expenses">
<label>Savings/Goals</label><input type="number" id="savings" placeholder="Auto-calculated">

<h3>Shopping Goals</h3>
<input type="text" id="itemName" placeholder="Item Name">
<input type="number" id="itemPrice" placeholder="Price">
<input type="file" id="itemImage" accept="image/*">
<button type="button" onclick="addShoppingToTable()">Add to List</button>

<div style="overflow-x:auto;">
<table id="shoppingTable">
<thead><tr><th>Select</th><th>Item</th><th>Price</th><th>Image</th><th>Achieved</th></tr></thead>
<tbody></tbody>
</table>
</div>
<button type="button" onclick="deleteSelectedItems()">Delete Selected Items</button>

<h3>Notes / Emotions / Goals</h3>
<textarea id="userNotes" rows="4" placeholder="Write notes, emotions, goals..." maxlength="500"></textarea>

<button type="button" onclick="addBudget()">Add Budget</button>
<button type="button" onclick="showWealthTips()">How to Grow Your Balance ðŸ’°</button>
<div id="wealthTips" style="display:none;"></div>
</form>

<div class="summary" id="summary" style="display:none;">
<h2>Summary</h2>
<p id="netSalary"></p>
<p id="totalExpenses"></p>
<p id="balance"></p>
<h3>Shopping List</h3>
<div id="shoppingSummary"></div>
<div id="notesSummary"></div>
</div>

<h3>Recent Months</h3>
<div id="recentMonths"></div>

<canvas id="pieChart" style="max-width:100%;"></canvas>
<canvas id="barChart" style="max-width:100%;"></canvas>

<footer>Powered by Evans</footer>

<script>
// ===== Menu Toggle =====
const menuToggle = document.getElementById('menuToggle');
const menuPanel = document.getElementById('menuPanel');
const menuOverlay = document.getElementById('menuOverlay');

function toggleMenu(){
  if(menuPanel.style.right==='0px'){
    menuPanel.style.right='-260px';
    menuOverlay.style.display='none';
  } else{
    menuPanel.style.right='0px';
    menuOverlay.style.display='block';
  }
}
menuToggle.addEventListener('click', toggleMenu);
menuOverlay.addEventListener('click', toggleMenu);

// ===== Dark Mode & Reach Us =====
function toggleDarkMode(){document.body.classList.toggle('dark');toggleMenu();}
function reachUs(){
  toggleMenu();
  const choice=prompt("Type 1 for WhatsApp, 2 for Telegram:");
  if(choice==='1') window.open("https://wa.me/254116726618","_blank");
  else if(choice==='2') window.open("https://t.me/Dilly125","_blank");
}

// ===== Budget Logic =====
let records = JSON.parse(localStorage.getItem('budgetRecords')||'[]');
let shoppingList=[];
const SHA_RATE=0.0275,NSSF_RATE=0.06,NSSF_CAP=2160,HOUSING_RATE=0.015;

function addShoppingToTable(){
  const name=document.getElementById('itemName').value;
  const price=parseFloat(document.getElementById('itemPrice').value);
  const file=document.getElementById('itemImage').files[0];
  if(!name || isNaN(price)){ alert("Enter valid item and price"); return;}
  let imgData=null;
  if(file){
    if(file.size>5*1024*1024){ alert("Max image size 5MB"); return;}
    const reader=new FileReader();
    reader.onload=function(e){ imgData=e.target.result; shoppingList.push({name,price,image:imgData,achieved:false}); renderShoppingTable();};
    reader.readAsDataURL(file);
  } else shoppingList.push({name,price,image:null,achieved:false});
  renderShoppingTable();
  document.getElementById('itemName').value=''; document.getElementById('itemPrice').value=''; document.getElementById('itemImage').value='';
}

function renderShoppingTable(){
  const tbody=document.querySelector('#shoppingTable tbody'); tbody.innerHTML='';
  shoppingList.forEach((item,i)=>{
    const row=document.createElement('tr');
    row.innerHTML=`<td><input type="checkbox" data-index="${i}"></td>
    <td>${item.name}</td>
    <td>${item.price.toFixed(2)}</td>
    <td>${item.image?'<img src="'+item.image+'" class="goalImage">':''}</td>
    <td><input type="checkbox" ${item.achieved?'checked':''} onclick="toggleAchieve(${i},this.checked)"></td>`;
    tbody.appendChild(row);
  });
}
function toggleAchieve(i,val){shoppingList[i].achieved=val;}
function deleteSelectedItems(){
  const checkboxes=document.querySelectorAll('#shoppingTable tbody input[type="checkbox"][data-index]:checked');
  const indexes=Array.from(checkboxes).map(cb=>parseInt(cb.getAttribute('data-index')));
  shoppingList=shoppingList.filter((_,i)=>!indexes.includes(i));
  renderShoppingTable();
}

// ===== Add Budget with Duplicate Prevention =====
function addBudget(){
  const month=document.getElementById('month').value;
  const year=document.getElementById('year').value;
  const salary=parseFloat(document.getElementById('salary').value);
  if(!month || !year || isNaN(salary)){ alert("Select month/year/salary"); return;}
  
  const monthYearKey = month+" "+year;
  const existingIndex = records.findIndex(r=>r.monthYear===monthYearKey);
  if(existingIndex!==-1){
    if(!confirm("This month/year already exists. Click OK to replace existing record.")) return;
    records.splice(existingIndex,1); // remove old
  }

  const rent=parseFloat(document.getElementById('rent').value)||0;
  const food=parseFloat(document.getElementById('food').value)||0;
  const transport=parseFloat(document.getElementById('transport').value)||0;
  const other=parseFloat(document.getElementById('other').value)||0;
  const useNSSF=document.getElementById('useNSSF').checked;
  const useSHA=document.getElementById('useSHA').checked;
  const useHousing=document.getElementById('useHousing').checked;
  const notes=document.getElementById('userNotes').value;
  const nssf=useNSSF?Math.min(salary*NSSF_RATE,NSSF_CAP):0;
  const sha=useSHA?salary*SHA_RATE:0;
  const housing=useHousing?salary*HOUSING_RATE:0;
  const totalExp=rent+food+transport+other+nssf+sha+housing;
  const savings=salary-totalExp;
  document.getElementById('savings').value=savings.toFixed(2);
  
  const entry={monthYear:monthYearKey,grossSalary:salary,deductions:{nssf,sha,housing},expenses:{rent,food,transport,other},shopping:[...shoppingList],savings,notes};
  records.push(entry);
  localStorage.setItem('budgetRecords',JSON.stringify(records));
  shoppingList=[];
  renderShoppingTable();
  displaySummary(entry);
  alert("Budget saved!");
}

// ===== Display Summary =====
function displaySummary(entry){
  document.getElementById('summary').style.display='block';
  document.getElementById('netSalary').innerText="Gross Salary: KES "+entry.grossSalary.toFixed(2);
  const totalExp=entry.deductions.nssf+entry.deductions.sha+entry.deductions.housing+entry.expenses.rent+entry.expenses.food+entry.expenses.transport+entry.expenses.other;
  document.getElementById('totalExpenses').innerText="Total Expenses: KES "+totalExp.toFixed(2);
  document.getElementById('balance').innerText="Balance/Savings: KES "+entry.savings.toFixed(2);
  
  const shoppingDiv=document.getElementById('shoppingSummary'); shoppingDiv.innerHTML="";
  entry.shopping.forEach(item=>{
    const div=document.createElement('div');
    div.innerHTML=`<strong>${item.name}</strong> - KES ${item.price.toFixed(2)}<br>${item.image?'<img src="'+item.image+'" class="goalImage">':''}<br>Status: ${item.achieved?'Achieved':'Unachieved'}`;
    shoppingDiv.appendChild(div);
  });

  const notesDiv=document.getElementById('notesSummary'); 
  notesDiv.innerHTML=`<h4>Notes / Emotions / Goals</h4><p>${entry.notes || "No notes added."}</p>`;
}

// ===== Show Wealth Tips =====
function showWealthTips(){
  const tips=document.getElementById('wealthTips');
  tips.style.display = tips.style.display==='block'?'none':'block';
  tips.innerHTML="<h4>5 Ways to Grow Your Balance</h4><ol><li>MMF: Low-risk money market funds.</li><li>Stocks: Invest in shares for higher returns.</li><li>Savings account: High-interest savings account.</li><li>Side Hustle: Freelance or small business.</li><li>Government bonds: Secure long-term investments.</li></ol>";
}

// ===== View Previous Months =====
function viewPreviousMonths(){
  toggleMenu();
  const div=document.getElementById('recentMonths'); div.innerHTML="";
  records.forEach(entry=>{
    const d=document.createElement('div');
    d.innerHTML=`<strong>${entry.monthYear}</strong> - Balance: KES ${entry.savings.toFixed(2)} <button onclick='displaySummary(records.find(r=>r.monthYear==="${entry.monthYear}"))'>View Details</button>`;
    div.appendChild(d);
  });
}

// ===== Simulation =====
function simulateMillion(){
  toggleMenu();
  const salary=parseFloat(prompt("Enter your monthly net salary:"))||0;
  const savings=parseFloat(prompt("Enter your monthly savings:"))||0;
  const years=10;
  const months=years*12;
  const rate=0.07/12;
  let balance=0;
  for(let i=0;i<months;i++) balance=(balance+savings)*(1+rate);
  alert("If you save KES "+savings+" per month with 7% yearly interest, you will have KES "+balance.toFixed(2)+" in 10 years.");
}

// ===== Search Records by Month =====
function searchRecords(){
  toggleMenu();
  const monthSearch = prompt("Enter month/year to search (e.g., 'January 2026'):");
  if(!monthSearch) return;
  const found = records.find(r=>r.monthYear.toLowerCase()===monthSearch.toLowerCase());
  if(found) displaySummary(found);
  else alert("No record found for "+monthSearch);
}
</script>
</body>
</html>